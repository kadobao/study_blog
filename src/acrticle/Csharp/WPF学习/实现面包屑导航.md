---
title: 实现面包屑导航
icon: code
order: 20
category:
  - C#学习
tag:
  - WPF
  - 面包屑导航
---

# 实现面包屑导航

本文将介绍如何在WPF中实现面包屑导航功能。面包屑导航是一种常见的导航模式，可以清晰地显示用户当前所在的位置，并提供快速返回上级页面的功能。

## 实现步骤

### 步骤1：创建面包屑项模型

首先，我们需要创建一个模型类来表示面包屑导航中的每一项。

```csharp
// Models/BreadcrumbItem.cs
public class BreadcrumbItem
{
    public string Title { get; set; }  // 显示的标题
    public string Path { get; set; }   // 导航路径
    public bool IsLast { get; set; }   // 是否为最后一项
}
```

### 步骤2：创建面包屑导航样式

创建样式资源文件，定义面包屑导航的外观和交互效果。

```xml
<!-- Styles/BreadcrumbStyles.xaml -->
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <!-- 面包屑导航容器的样式 -->
    <Style x:Key="BreadcrumbContainerStyle" TargetType="ItemsControl">
        <!-- 设置 ItemsPanel 为水平 StackPanel，使所有面包屑项水平排列 -->
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="Margin" Value="10"/>
    </Style>
    
    <!-- 面包屑导航项的样式 -->
    <Style x:Key="BreadcrumbNavigationStyle" TargetType="ContentControl">
        <!-- 默认样式（非最后一项） -->
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ContentControl">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="{Binding Title}" 
                                    Margin="0,0,5,0"
                                    Foreground="#0078D7"
                                    Cursor="Hand"/>
                        <TextBlock Text=">" 
                                    Margin="0,0,5,0"
                                    Foreground="Gray"/>
                    </StackPanel>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
        
        <!-- 样式触发器 -->
        <Style.Triggers>
            <!-- 鼠标悬停效果 -->
            <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ContentControl">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Title}" 
                                            Margin="0,0,5,0"
                                            Foreground="#005499"
                                            Cursor="Hand"/>
                                <TextBlock Text=">" 
                                            Margin="0,0,5,0"
                                            Foreground="Gray"/>
                            </StackPanel>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Trigger>
            
            <!-- 最后一项的样式 -->
            <DataTrigger Binding="{Binding IsLast}" Value="True">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="ContentControl">
                            <TextBlock Text="{Binding Title}" 
                                        Foreground="Black"
                                        FontWeight="Bold"/>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </DataTrigger>
        </Style.Triggers>
    </Style>
</ResourceDictionary>
```

### 步骤3：在XAML中使用面包屑导航

在视图文件中添加面包屑导航控件（可以直接应用下面的代码，只要在ViewModel中定义好 `BreadcrumbItems` 集合和 `NavigateToCommand` 命令即可）：

```xml
<!-- 面包屑导航 -->
<!-- ItemsControl会遍历绑定的 BreadcrumbItems 集合，为集合中的 每一个元素 创建一个对应的UI项，并应用指定的样式。 -->
<!-- ItemsSource属性可以绑定到任何实现了 IEnumerable接口的集合。最常用的是绑定到一个 ObservableCollection<T>，这样当集合发生变化（增、删、改）时，UI 会自动同步更新。 -->
<ItemsControl x:Name="BreadcrumbControl" 
                ItemsSource="{Binding BreadcrumbItems}" 
                Grid.Row="0" 
                Style="{StaticResource BreadcrumbContainerStyle}">
    <ItemsControl.ItemTemplate>
        <DataTemplate>
            <!-- 在WPF中， {Binding} 没有指定路径时表示绑定到当前的数据上下文(DataContext)本身。 -->
            <ContentControl Content="{Binding}" Style="{StaticResource BreadcrumbNavigationStyle}">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="MouseDown">
                        <i:InvokeCommandAction 
                            Command="{Binding DataContext.NavigateToCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                            CommandParameter="{Binding Path}"/>
                    </i:EventTrigger>
                </i:Interaction.Triggers>
            </ContentControl>
        </DataTemplate>
    </ItemsControl.ItemTemplate>
</ItemsControl>
```

### 步骤4：在ViewModel中实现逻辑

在ViewModel中添加面包屑导航的相关属性和命令：

```csharp
using System.Collections.ObjectModel;

namespace ViewModels
{
    public class YourViewModel
    {
        // 面包屑导航集合
        public ObservableCollection<BreadcrumbItem> BreadcrumbItems { get; private set; }
        
        // 导航命令
        public DelegateCommand<string> NavigateToCommand { get; private set; }
        
        // 构造函数
        public YourViewModel()
        {
            // 初始化集合实例
            BreadcrumbItems = new ObservableCollection<BreadcrumbItem>();
            
            // 初始化面包屑数据
            ResetToHomePage();
            
            // 初始化导航命令
            NavigateToCommand = new DelegateCommand<string>(NavigateTo);
        }
        
        // 重置到首页
        private void ResetToHomePage()
        {
            BreadcrumbItems.Clear();
            BreadcrumbItems.Add(new BreadcrumbItem { Title = "首页", Path = "/home", IsLast = true });
        }
        
        // 导航到首页
        private void GoToHome()
        {
            ResetToHomePage();
            // 这里可以添加Prism导航逻辑：_regionManager.RequestNavigate("ContentRegion", "HomeView");
        }
        
        // 导航到产品页
        private void GoToProduct()
        {
            // 更新面包屑导航：首页 -> 产品
            BreadcrumbItems.Clear();
            BreadcrumbItems.Add(new BreadcrumbItem { Title = "首页", Path = "/home", IsLast = false });
            BreadcrumbItems.Add(new BreadcrumbItem { Title = "产品", Path = "/products", IsLast = true });
            
            // 这里可以添加Prism导航逻辑：_regionManager.RequestNavigate("ContentRegion", "ProductView");
        }
        
        // 导航到详情页
        private void GoToDetail()
        {
            // 更新面包屑导航：首页 -> 产品 -> 详情
            BreadcrumbItems.Clear();
            BreadcrumbItems.Add(new BreadcrumbItem { Title = "首页", Path = "/home", IsLast = false });
            BreadcrumbItems.Add(new BreadcrumbItem { Title = "产品", Path = "/products", IsLast = false });
            BreadcrumbItems.Add(new BreadcrumbItem { Title = "详情", Path = "/products/123", IsLast = true });
            
            // 这里可以添加Prism导航逻辑：_regionManager.RequestNavigate("ContentRegion", "DetailView");
        }
        
        // 面包屑导航命令处理方法
        private void NavigateTo(string path)
        {
            // 根据路径执行相应的导航逻辑
            switch (path)
            {
                case "/home":
                    GoToHome();
                    break;
                case "/products":
                    GoToProduct();
                    break;
                case "/products/123":
                    GoToDetail();
                    break;
                // 可以添加更多路径处理
            }
        }
    }
}
```

## 实现要点

1. **数据模型**：使用 `BreadcrumbItem` 类表示面包屑的每一项，包含标题、路径和是否为最后一项的标识。

2. **样式设计**：
   - 容器使用水平排列的 `StackPanel`
   - 每一项包含标题和分隔符 ">"
   - 最后一项不显示分隔符，样式为粗体黑色
   - 非最后一项显示为蓝色，鼠标悬停时颜色变深

3. **交互处理**：
   - 使用 `Interaction.Triggers` 绑定鼠标点击事件
   - 通过 `NavigateToCommand` 命令处理导航逻辑
   - 根据路径参数执行不同的导航方法

4. **导航逻辑**：
   - 每次导航时清空并重建面包屑集合
   - 可以结合 Prism 的 `RegionManager.RequestNavigate` 方法实现实际的页面导航