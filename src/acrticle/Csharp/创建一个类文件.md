---
title: 创建一个类文件
icon: code
order: 23
category:
  - C#学习
tag:
  - 类文件
---

# 创建一个类文件

## 类文件组成部分

类文件主要由以下几个部分组成：

1. **静态变量**
   - 用于存储共享的配置或常量
   - 所有实例可以共享访问
   - 公共方法也可以调用静态变量

2. **构造函数**
   - 初始化类的实例
   - 接收外部依赖（如 HttpClient）

3. **供外部调用的函数（公共方法）**
   - 提供类的核心功能
   - 供外部代码调用

4. **依赖管理**
   - 把函数需要的变量和类似 HttpClient 都在构造函数里初始化或传递
   - 遵循依赖注入原则

## 代码示例

下面是一个完整的类文件示例，展示了如何组织这些部分：

```csharp
using System;
using System.Net.Http;
using System.Threading.Tasks;

namespace MyApplication.Services
{
    public class UserService
    {
        // 1. 静态变量：API 的基础地址（所有实例共享），公共方法也可以调用
        private static readonly string BaseApiUrl = "https://api.example.com";

        // 2. 私有字段，用于存储构造函数中初始化的依赖
        private readonly HttpClient _httpClient;

        // 3. 构造函数：初始化或接收依赖（推荐通过依赖注入传入 HttpClient）
        public UserService(HttpClient httpClient)
        {
            _httpClient = httpClient ?? throw new ArgumentNullException(nameof(httpClient));
            _httpClient.BaseAddress = new Uri(BaseApiUrl);
        }

        // 4. 公共方法：供外部调用
        public async Task<string> GetUserAsync(int userId)
        {
            // 调用 API 获取用户信息
            var response = await _httpClient.GetAsync($"/users/{userId}");
            response.EnsureSuccessStatusCode(); // 如果状态码不是 2xx，抛出异常

            return await response.Content.ReadAsStringAsync();
        }

        public async Task<bool> CreateUserAsync(string userName)
        {
            var content = new StringContent($"{{\"name\": \"{userName}\"}}", System.Text.Encoding.UTF8, "application/json");
            var response = await _httpClient.PostAsync("/users", content);
            return response.IsSuccessStatusCode;
        }
    }
}
```

## 直接实例化示例

下面是另一种实现方式，直接在构造函数中实例化 HttpClient：

```csharp
using System;
using System.Net.Http;
using System.Threading.Tasks;

namespace MyApplication.Services
{
    public class UserServiceDirect
    {
        // 1. 静态变量：API 的基础地址
        private static readonly string BaseApiUrl = "https://api.example.com";

        // 2. 私有字段，直接在构造函数中实例化
        private readonly HttpClient _httpClient;

        // 3. 构造函数：直接创建 HttpClient 实例
        public UserServiceDirect()
        {
            _httpClient = new HttpClient();
            _httpClient.BaseAddress = new Uri(BaseApiUrl);
            
            // 可以在这里设置默认请求头等配置
            _httpClient.DefaultRequestHeaders.Add("User-Agent", "MyApp/1.0");
            _httpClient.Timeout = TimeSpan.FromSeconds(30);
        }

        // 4. 公共方法：供外部调用
        public async Task<string> GetUserAsync(int userId)
        {
            var response = await _httpClient.GetAsync($"/users/{userId}");
            response.EnsureSuccessStatusCode();
            return await response.Content.ReadAsStringAsync();
        }

        public async Task<bool> CreateUserAsync(string userName)
        {
            var content = new StringContent($"{{\"name\": \"{userName}\"}}", System.Text.Encoding.UTF8, "application/json");
            var response = await _httpClient.PostAsync("/users", content);
            return response.IsSuccessStatusCode;
        }

        // 5. 释放资源：实现 IDisposable 接口
        public void Dispose()
        {
            _httpClient?.Dispose();
        }
    }
}
```