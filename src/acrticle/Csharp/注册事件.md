---
title: 注册事件
icon: code
order: 20
category:
  - C#学习
tag:
  - 注册事件
  - 委托
---


## 事件（Event）与委托（Delegate）的区别

### 核心区别

事件是对委托的封装，只允许 `+=` 和 `-=` 操作，禁止直接赋值（`=`）和调用（`Invoke`）。

### 事件比委托多了一层封装

#### 委托的本质

委托（Delegate）是一个**方法指针列表**，可以存储多个方法。
外部代码可以**直接修改**这个列表（赋值、调用、清空）。

#### 事件的本质

事件（Event）在**委托的基础上**增加了一层**访问控制**：
- **外部只能 `+=` 订阅和 `-=` 取消订阅**，不能直接修改委托。
- **只能在`声明事件的类`内部触发**（如 `OnClick()` 方法）。

#### 事件的预定义委托

C# 提供了内置的 `EventHandler` 和 `EventHandler<TEventArgs>` 委托：

```csharp
public event EventHandler MyEvent; // 无自定义参数
public event EventHandler<MyEventArgs> MyEventWithData; // 带自定义参数
```

### 事件示例

```csharp
public class Button
{
    // 1. 声明事件
    public event EventHandler Click;
    
    // 触发事件的方法
    public void OnClick()
    {
        Click?.Invoke(this, EventArgs.Empty);     // **只能在`声明事件的类`内部触发**，这个在`Button`类内部，所以是在`Button`类内部触发的
    }
}

public class Program
{
    public static void Main()
    {
        Button btn = new Button();
        
        // 2. 注册事件处理程序
        btn.Click += Button_Click;
        
        // 触发事件
        btn.OnClick();
    }
    
    // 3. 事件处理方法
    private static void Button_Click(object sender, EventArgs e)
    {
        Console.WriteLine("按钮被点击了！");
    }
}
```

## 委托订阅和发布事件的参数匹配规则

### 参数签名必须严格匹配

委托的订阅和发布事件的参数都必须严格符合委托的签名。这意味着：

- **订阅事件的方法参数**必须与委托定义的参数类型和数量完全一致
- **发布事件时传递的参数**也必须与委托定义的参数类型和数量完全一致

### 订阅事件的参数来源

订阅事件的参数来源于发布事件传递过来的参数。当事件被触发时，发布者会将参数传递给所有订阅了该事件的方法。

### 总结

1. **委托签名定义了参数契约**：订阅和发布都必须遵循这个契约
2. **订阅者接收发布者传递的参数**：参数流向是单向的，从发布者到订阅者
3. **参数匹配是编译时检查**：不匹配的参数会在编译阶段报错
4. **事件参数通常包含事件相关信息**：如事件源(sender)和事件数据(e)