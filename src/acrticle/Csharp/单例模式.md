---
title: 单例模式
icon: code
order: 11
category:
  - C#学习
tag:
  - 设计模式
  - 单例模式
---

# 实现单例模式

单例模式是一种常用的软件设计模式，它保证一个类只有一个实例，并提供一个全局访问点。以下是实现线程安全的单例模式的步骤：

## 步骤 1: 创建类并设置私有构造函数

将类的构造函数设为私有，防止外部直接实例化。

```csharp
public class Log
{
    // 私有构造函数，防止外部实例化
    private Log()
    {
        Init();
    }
}
```

## 步骤 2: 声明私有静态实例变量

在类内部声明一个私有的静态变量，用于存储唯一实例。

```csharp
// 单例实例
private static Log _instance;
```

## 步骤 3: 声明锁对象

声明一个锁对象，确保线程安全。

```csharp
// 锁对象，确保线程安全
private static readonly object _lockObject = new object();
```

## 步骤 4: 创建公共静态方法获取实例

创建一个公共的静态方法，用于获取实例，并使用双重检查锁定模式确保线程安全。

```csharp
// 获取单例实例的静态方法（线程安全版本）
public static Log GetInstance()
{
    if (_instance == null)
    {
        lock (_lockObject)
        {
            if (_instance == null)
            {
                _instance = new Log();
            }
        }
    }
    return _instance;
}
```

## 双重检查锁定模式说明

双重检查锁定模式确保线程安全的步骤如下：

1. 先检查实例是否为空，不为空就直接返回唯一实例
2. 如果为空，加锁
3. 锁内再次检查实例是否为空
4. 如果仍为空，创建新实例
5. 返回唯一实例

## 完整的代码示例

```csharp
public class Log
{
    // 私有构造函数，防止外部实例化
    private Log()
    {
        Init();
    }

    // 单例实例
    private static Log _instance;

    // 锁对象，确保线程安全
    private static readonly object _lockObject = new object();

    // 初始化方法
    private void Init()
    {
        // 初始化代码
    }

    // 获取单例实例的静态方法（线程安全版本）
    public static Log GetInstance()
    {
        if (_instance == null)
        {
            lock (_lockObject)
            {
                if (_instance == null)
                {
                    _instance = new Log();
                }
            }
        }
        return _instance;
    }
}
```